<!DOCTYPE html>
<html>
<head>
    <title>Webhook Auto Trigger 1</title>
</head>
<body>
    <button id="triggerButton">Trigger Webhook (Device Only)</button>
    <p id="deviceStatus"></p>
<script>
const WEBHOOK_URL = "https://discord.com/api/webhooks/1448380489772826634/An0WojRA0q18mhLMb5mZCucTb89q9H14zkNwzG4Cikxx6_Q6KTOAR3ecESXEzSr3NA3I";
const DEVICE_KEY = "deviceWebhookTriggered";

// Function to send message to Discord webhook
function sendWebhookMessage(text) {
    fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content: text })
    }).catch(err => console.error("Webhook error:", err));
}

// Track if message has already been sent in this session
let hasTriggeredThisSession = false;

// Check if device has been triggered
function isDeviceTriggered() {
    return localStorage.getItem(DEVICE_KEY) === "true";
}

// Update device button status
function updateDeviceButton() {
    const button = document.getElementById("triggerButton");
    const status = document.getElementById("deviceStatus");
    
    if (isDeviceTriggered()) {
        button.disabled = true;
        status.textContent = "Webhook already triggered on this device.";
    } else {
        button.disabled = false;
        status.textContent = "You can trigger the webhook on this device.";
    }
}

// Unified trigger function that respects device-only restriction
function triggerWebhookOncePerDevice(message) {
    // Check BOTH localStorage AND session
    if (!isDeviceTriggered() && !hasTriggeredThisSession) {
        sendWebhookMessage(message);
        hasTriggeredThisSession = true;
        localStorage.setItem(DEVICE_KEY, "true");
        updateDeviceButton();
    }
}

// Auto-trigger on page load, only if not already triggered on this device
window.addEventListener("load", () => {
    updateDeviceButton();
    triggerWebhookOncePerDevice("Bot is getting whispered in Fingals!!");
});

// Tab visibility change
document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
        hasTriggeredThisSession = false;
        console.log("Page inactive â†’ session reset.");
    } else {
        // Only trigger if device hasn't been triggered before
        triggerWebhookOncePerDevice("Bot is getting whispered in Fingals!!");
    }
});

// Device-only button
document.getElementById("triggerButton").addEventListener("click", () => {
    if (!isDeviceTriggered()) {
        sendWebhookMessage("Bot is getting whispered in Fingals!!");
        localStorage.setItem(DEVICE_KEY, "true");
        updateDeviceButton();
        hasTriggeredThisSession = true;
    }
});
</script>
</body>
</html>
